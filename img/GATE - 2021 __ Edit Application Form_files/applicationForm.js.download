/**
 * TODO: Make header responsive
 * 
 * function resize() { var n = $("body").width() / 60 + "pt";
 * $("h1").css('fontSize', n); } $(window).on("resize", resize);
 * $(document).ready(resize);
 */

var cloneIdProofs = null;
var cloneStates = null;
var cloneQualificationYear = null;
var cloneCountryCodes = null;

$(function() {
	//$('#mobileOTP_ShowAfterSuccessfulOTPVerification').hide();
	//$('#emailOTP_ShowAfterSuccessfulOTPVerification').hide();
	$("select").css("border", "1px solid #ccc");
	$("select").css("font-size", "14px");
	$(".easy-autocomplete").css("width", "100%");
	$("#country").on("change", fetchExamCities1);
	$("#gatePaper").on("change", gatePaper);
	$("#examCity1").on("change", fetchExamCities2);
	$("#examCity2").on("change", fetchExamCities3);
	$("#examCity3").on("change", fetchExamCities4);
	// $("#verifyEmail").on("click", verifyEmailOTP);

	$("#firstName, #middleName, #lastName").on("input",concatName);
		
	$("input:radio[name=isDegreeComplete]").on("change", populateQualificationYear);
	$('input[name="nationality"]').on("change", toggleCategoryList);
	//$('input[name="personWithDisability"]').on("change", toggleScribeRequest(true));
	$('input[name="personWithDisability"]').on("change", function(){ 
		toggleScribeRequest(true);
	});
	$('input[name="personWithDyslexic"]').on("change", function(){
		toggleScribeRequest(true);
	});	
	//$('input[name="personWithDyslexic"]').on("change", toggleScribeRequest(true));
	$('input[name="visuallyImpaired"]').on("change", showScribeText);
	$('input[name="category"]').on("change", toggleCategoryCert);
	/*$('input[name="category"]').on("change", function() {
		toggleCategoryCert(true);
	});*/
	/*$('input[name="category"]').on("change", toggleEws(true));*/

	$('input[name="nationalityParent"]').on("change", function(){
		toggleParentNationalityList(true);
	});
	$("#nationalityParentValue").on("change", changeParentMobileCountryCode);

	/*$('input[name="isDegreeComplete"]').on("change", toggleEligCert);*/
	//$('input[name="isDegreeComplete"]').on("change", toggleDegreeCompleteText);
	$('#continuePaperSelection').click(continueStep1);
	$("#submitApplicationForm").click(continueStep2);
	$("#saveAndViewApplicationForm").click(saveAndView);
	// $('#continueStep1').click(continueStep1);
	// $('#continueStep2').click(continueStep2);
	
	$("#idProof").on("change",toggleIdProofNoLength);
	$('input[name="noOfPapers"]').on("change", toggleSecondPaper);
	//$("#gatePaper2").on("change", toggleNoOfPapers);
	$("#gatePaper").on("change", function() {
		populateSecondPaper(true);
	});

	if (!isCanvasSupported()) { // fallback mechanism for canvas, connecting to
		// old upload functionality.
		var jq = document.createElement('script');
		jq.src = "./js/oldPhotoSignUpload.js";
		document.getElementsByTagName('head')[0].appendChild(jq);
	}

	createClones();
	//toggleSubpaper();
	populateQualificationYear();
	toggleIdProofs(false);
	toggleIdProofNoLength();
	toggleCities();
	toggleScribeRequest(false);
	showScribeText();
	/*toggleEws(false);*/
	toggleCategoryCert();
	toggleCategoryList();

	//selectCountryCodeForParent();
//	changeParentMobileCountryCode();
	toggleParentNationalityList(false);
	/*toggleEligCert();*/
	toggleSecondPaper();
	populateSecondPaper(false);
	showSubpaper1();
	showSubpaper2();
	$('#pwdPercentage').keydown(maskInput);

	return true;
});

function toggleIdProofNoLength()
{
	var idProof = $("#idProof").val();
	if(idProof == "5")
	{
		$('#idProofNo').attr('maxlength', '12');
	}
	else if(idProof == "3")
	{
		$('#idProofNo').attr('maxlength', '10');
	}
	else
	{
		$('#idProofNo').removeAttr('maxlength');
	}
}

function toggleEditNameWrap()
{
	var currentId = $("#editName").attr("currentId");
	if(currentId == "editName")
	{
		$("#editNamewrap").removeClass("hidden");
		$("#editName").html("Confirm Name");
		$("#editName").attr("currentId","confirmName");
	}
	else
	{
		$("#editNamewrap").addClass("hidden");
		$("#editName").html("Edit Name");
		$("#editName").attr("currentId","editName");
	}
}
function showSubpaper1(){
	var paper1 = $("#gatePaper").val();
	if(paper1 == "GG" || paper1 == "XH")
	{
		return;
	}
	else
	{
		$("#subpaperWrap1").hide();
		$('#gateSubpaper').empty().append('<option value="-1">Select Subpaper for paper 1</option>');
	}
}
function showSubpaper2(){
	var paper2 = $("#gatePaper2").val();
	if(paper2 == "GG" || paper2 == "XH")
	{
		return;
	}
	else
	{
		$("#subpaperWrap2").hide();
		$('#gateSubpaper2').empty().append('<option value="-1">Select Subpaper for paper 2</option>');
	}
}

function showSubpaper(mainPaper, paperNo, isChanged)
{
	//console.log("paper No : " +paperNo);
	var subpaper;
	if(paperNo == 1)
	{
		subpaper = $("#gateSubpaper").val();
		$('#gateSubpaper').empty().append('<option value="-1">Select Subpaper for paper ' + paperNo + '</option>');
	}
	else
	{
		subpaper = $("#gateSubpaper2").val();
		$('#gateSubpaper2').empty().append('<option value="-1">Select Subpaper for paper ' + paperNo + '</option>');
	}
	//console.log("subp = " +subpaper);
	
	if(mainPaper == "GG" || mainPaper == "XH")
	{
		$("#subpaperWrap"+paperNo).show();
		
		var formInput = {
			gatePaper : mainPaper + "-" + paperNo
		};
		
		if (mainPaper == -1 || mainPaper == null) {
			return;
		} 
		else 
		{
			$.getJSON('getSubpapers.html', formInput, function(data) {
				
				var sortedSubpapers = jsonObjToSortedArray(data.subpapers);
				if(paperNo == 2)
				{
					loadSelectBoxNew('#gateSubpaper'+paperNo, sortedSubpapers);
					$("#subpaperWrap2").show();
					if(isChanged == false)
						$("#gateSubpaper"+paperNo).val(subpaper);
				}
				else
				{
					loadSelectBoxNew('#gateSubpaper', sortedSubpapers);
					$("#subpaperWrap1").show();
					if(isChanged == false)
						$("#gateSubpaper").val(subpaper);
				}
			}).error(function() {
				$('#sessionExpired').modal({
					backdrop : 'static',
					keyboard : false
				}).one('click', '#ok', function(e) {
					location.href = "login.html";
					return true;
				});
			});
		}

	}
	else
	{
		if(paperNo == 1)
			$("#gateSubpaper").children('option:not(:first)').remove();
		else
			$("#gateSubpaper"+paperNo).children('option:not(:first)').remove();
		
		$("#subpaperWrap"+paperNo).hide();
	}
}

function populateSecondPaper(isChanged)
{ 
	//console.log("in populateSecondPaper()" + $("#gateSubpaper2").val());
	var mainPaper = $("#gatePaper").val();
	var paper2 = $("#gatePaper2").val();
	var options = $("#paperComboMap")[0].options;
	//console.log(options.length);
	var match = false;
	for(let i=0;i<options.length;i++)
	{
		if(options[i].value == mainPaper)
		{
			match = true;
			//console.log("match found");
			//console.log(options[i].value + "-" + options[i].text);
			var allowedPaperString = (options[i].text);
			var allowedPaperString = allowedPaperString.substring(1, allowedPaperString.length-1);
			var array = allowedPaperString.split(", ");
			//console.log("array = " + array.length);
			
			var paperOptions = $("#gatePaper")[0].options;
			var paper2map = {};
			for(let j=0; j<array.length; j++)
			{
				for(let k=0; k<paperOptions.length; k++)
				{
					if(array[j] == paperOptions[k].value)
					{
						paper2map[paperOptions[k].value] = paperOptions[k].text;
					}
				}
			}
			//$("#secondPaperWrap").show();
			$("#gatePaper2").children('option:not(:first)').remove();
			
			$.each(paper2map, function(key, value){
				//console.log(key + "--" + value);
				$("#gatePaper2").append('<option value="'+ key +'">'+ value +'</option>');
			});
			if(isChanged == false)
			{
				$("#gatePaper2").val(paper2);
			}
			else
			{
				$("#gateSubpaper2").children('option:not(:first)').remove();
			}
			//paperOptions2 = $("#gatePaper2")[0].options;
			//console.log(paperOptions2.length);
			break;
		}
	}
	if(match == false)
	{
		$("#gatePaper2").children('option:not(:first)').remove();
		$("#gateSubpaper2").children('option:not(:first)').remove();
		$("input[name=noOfPapers][value='1']").prop("checked",true);
		$("#secondPaperWrap").hide();
	}
}

/*function toggleNoOfPapers(){
	var paper2 = $("#gatePaper2").val();
	console.log("paper2.val : " +paper2);
	if(paper2.trim() != '' && paper2.trim() != '-1'){
		$("input[name=noOfPapers][value='2']").prop("checked",true);
	}
	else{
		$("input[name=noOfPapers][value='1']").prop("checked",true);
	}
}*/

function toggleSecondPaper(){
	//console.log("in toggleSecondPaper() " + $("#gateSubpaper2").val());
	var noOfPapers = $('input[name="noOfPapers"]:checked').val();
	if (noOfPapers == "1") {
		$("#secondPaperWrap").hide();
		$("#gatePaper2").val(-1);
		$("#gateSubpaper2").val(-1);
	}else{
		$("#secondPaperWrap").show();
	}
}

function gatePaper() {
	var selectedPaper = $("#gatePaper").val();
	if (selectedPaper != -1) {
		var paperName = $("#gatePaper option:selected").text();
		$('#selectedPaper').text(paperName);
		$('#confirmPaperSelection').modal({
			backdrop : 'static',
			keyboard : false
		}).one('click', '#continue', function(e) {
			//console.log("continue");
			return true;
		}).one('click', '#cancel', function(e) {
			//console.log("cancel");
			$("#gatePaper").val($("#gatePaper option:first").val());
			$("#gateSubpaper").children('option:not(:first)').remove();
			$("#gatePaper2").children('option:not(:first)').remove();
			$("#gateSubpaper2").children('option:not(:first)').remove();
		});
	}
}

function toggleEws(isChanged) {
	var category = $('input[name="category"]:checked').val();
	if (category == 1) {
		$('#ewsdiv').removeClass("hidden");
		if (isChanged)
			$("input[name=isews][value='false']").prop("checked",true);
	}
	else{
		$('#ewsdiv').addClass("hidden");
	}
}

function maskInput(e) {
	//check if we have "e" or "window.event" and use them as "event"
	//Firefox doesn't have window.event 
	var event = e || window.event 

	var key_code = event.keyCode;
	var oElement = e ? e.target : window.event.srcElement;
	if (!event.shiftKey && !event.ctrlKey && !event.altKey) {
		if ((key_code > 47 && key_code < 58) ||
				(key_code > 95 && key_code < 106)) {

			if (key_code > 95)
				key_code -= (95-47);
			oElement.value = oElement.value;
		} else if(key_code == 8) {
			oElement.value = oElement.value;
		} else if(key_code != 9) {
			event.returnValue = false;
		}
	}
}

function createClones() {
	if (cloneStates == null) {
		cloneStates = $("#corrAddrState").html();
	}

	if (cloneQualificationYear == null) {
		cloneQualificationYear = $("#yearOfQualifyingDegree").html();
	}

	if (cloneIdProofs == null) {
		cloneIdProofs = $("#idProof").html();
	}

	if (cloneCountryCodes == null) {
		cloneCountryCodes = $("#parentMobileCountryCode").html();
	}
}

function isCanvasSupported() {
	var elem = document.createElement('canvas');
	return !!(elem.getContext && elem.getContext('2d'));
}
/****************************************************************************************************************/
function populateQualificationYear() {

	var isDegreeCompleted = $('input:radio[name=isDegreeComplete]:checked').val();
	$('#yearOfQualifyingDegree').empty().html(cloneQualificationYear);

	if (isDegreeCompleted == 'true')
		$('#yearOfQualifyingDegree option').filter(function() {
			return parseInt(this.value, 10) > 2020;
		}).remove();
	else
		$('#yearOfQualifyingDegree option').filter(function() {
			return parseInt(this.value, 10) < 2020 && this.value > -1;
		}).remove();
}

$("#corrAddressCountry").change(
		function() {
			var country = $("#corrAddressCountry").val();
			$('#corrAddrState').empty().html(cloneStates);

			if (country != 1 && country != -1) {
				$('#corrAddrState').empty().append(
				'<option value="XX">Other</option>');
				$('#corrAddrState').val('XX');
			} else {
				$("#corrAddrState option[value='XX']").remove();
				$('#corrAddrState').val(-1);
			}
		});

$("#permAddressCountry").change(
		function() {
			var country = $("#permAddressCountry").val();
			$('#applicationForm_permanentResidenceState').empty().html(
					cloneStates);
			if (country != 1 && country != -1) {
				$('#applicationForm_permanentResidenceState').empty()
				.append('<option value="XX">Other</option>');
				$('#applicationForm_permanentResidenceState').val('XX');
			} else {
				$(
				"#applicationForm_permanentResidenceState option[value='XX']")
				.remove();
				$('#applicationForm_permanentResidenceState').val(-1);
			}
		});

$(document).ready(function(){
	{
		var country = $("#permAddressCountry").val();
		//$('#applicationForm_permanentResidenceState').empty().html(cloneStates);
		if (country != 1 && country != -1) {
			$('#applicationForm_permanentResidenceState').empty()
			.append('<option value="XX">Other</option>');
			$('#applicationForm_permanentResidenceState').val('XX');
		} else {
			$("#applicationForm_permanentResidenceState option[value='XX']").remove();
			//$('#applicationForm_permanentResidenceState').val(-1);
		}
	}
})

$("#collegeCountry").change(
		function() {
			var country = $("#collegeCountry").val();
			$('#qualDegreeState').empty().html(cloneStates);

			if (country != 1 && country != -1) {
				$('#qualDegreeState').empty().append(
				'<option value="XX">Other</option>');
				$('#qualDegreeState').val('XX');
			} else {
				$("#qualDegreeState option[value='XX']").remove();
				$('#qualDegreeState').val(-1);
			}
		});

function toggleCategoryList() {
	//console.log("toggleCategoryList");
	var nationality = $('input[name="nationality"]:checked').val();
	if (nationality === "Other") {
		$("#category-1").prop("checked", true);
		toggleCategoryCert();
		$("#categoryList").hide();
		$("#nationality_countries").show();
		//console.log("toggleCategoryList if");
	} else {
		$("#categoryList").show();
		$("#nationality_countries").hide();
		$("#nationality_countries").val(-1);//prop("selectedIndex", 0);
		//console.log("toggleCategoryList else");
	}
}

function toggleIdProofs() {

	var country = $("#permAddressCountry").val();
	if (country != 1 && country != -1) {
		$('#idProof').empty().html(cloneIdProofs);
		$('#idProof option[value="1"]').remove();
		$('#idProof option[value="3"]').remove();
		$('#idProof option[value="4"]').remove();
		$('#idProof option[value="5"]').remove();
		$('#idProof option[value="8"]').remove();
	} else 
	{
		$('#idProof').empty().html(cloneIdProofs);
	}
}

$("#permAddressCountry").change(function() {
	var country = $("#permAddressCountry").val();
	$('#idProof').empty().html(cloneIdProofs);
	if (country != 1 && country != -1) {
		$('#idProof option[value="1"]').remove();
		$('#idProof option[value="3"]').remove();
		$('#idProof option[value="4"]').remove();
		$('#idProof option[value="5"]').remove();
		$('#idProof option[value="8"]').remove();
	}
	$('#idProof').val("-1");
});

function toggleCities() {
	var country = $("#country").val();

	if (country == 1 || country == -1) {
		$("#examCitiesWrapper").show();
		$('label[for="examCity1"]').text('Choice of Examination City 1');
	} else {
		$("#examCitiesWrapper").hide();
		$('label[for="examCity1"]').text('Choice of Examination City');
	}
}

function fetchExamCities1() {
	toggleCities();
	var formInput = {
			country : $(this).val()
	};
	$('#examCity1').empty().append(
	'<option value="-1">Select Exam City 1</option>');
	$('#examCity2').empty().append(
	'<option value="-1">Select Exam City 2</option>');
	$('#examCity3').empty().append(
	'<option value="-1">Select Exam City 3</option>');

	if ($(this).val() == -1) {
		return;
	} else {

		if ($(this).val() != 1) {
			$('#examCity1').empty().append(
			'<option value="-1">Select Exam City</option>');
		}

		$.getJSON('getExamCities1.html', formInput, function(data) {
			
			var sortedCities = jsonObjToSortedArray(data.examCities1);
			
			loadSelectBoxNew('#examCity1', sortedCities);
			//loadSelectBox('#examCity1', data.examCities1);
		}).error(function() {
			// alert("Your session is been expired ! ");
			// jQuery("#confirmPaperSelection").modal('show');
			$('#sessionExpired').modal({
				backdrop : 'static',
				keyboard : false
			}).one('click', '#ok', function(e) {
				location.href = "login.html";
				return true;
			});
			// location.href="login.html";
		});
	}
	/*
	 * console.log($(this).val()); if($(this).val() != 1){
	 * 
	 * $.getJSON('getExamCities1.html', formInput, function(data) {
	 * console.log(data); loadSelectBoxForExamCity1CountryWise('#examCity1',
	 * data.examCities1); }); } else{ console.log("India appending cities");
	 * 
	 * $.getJSON('getExamCities1.html', formInput, function(data) {
	 * console.log(data); loadSelectBoxForExamCity2('#examCity1',
	 * data.examCities1); }); }
	 */
}

function fetchExamCities2() {
	$('#examCity2').empty().append(
	'<option value="-1">Select Exam City 2</option>');
	$('#examCity3').empty().append(
	'<option value="-1">Select Exam City 3</option>');
	$('#examCity4').empty().append(
	'<option value="-1">Select Exam City 4</option>');

	toggleCities();
	var formInput = {
			examCity1 : $(this).val()
	};

	if ($(this).val() == -1 || $("#country").val() != 1) {
		return;
	} else {

		$.getJSON('getExamCities2.html', formInput, function(data) {
			
			var sortedCities = jsonObjToSortedArray(data.examCities2);
			
			loadSelectBoxNew('#examCity2', sortedCities);
			//loadSelectBox('#examCity2', data.examCities2);
			// loadSelectBoxForExamCity2('#examCity2', data.examCities2);
		}).error(function() {
			// alert("Your session is been expired ! ");
			// jQuery("#confirmPaperSelection").modal('show');
			$('#sessionExpired').modal({
				backdrop : 'static',
				keyboard : false
			}).one('click', '#ok', function(e) {
				location.href = "login.html";
				return true;
			});
			// location.href="login.html";
		});
	}
}

function fetchExamCities3() {
	toggleCities();
	var examCity1 = $('#examCity1').val();
	var examCity2 = $(this).val();
	var formInput = {
			"examCity1" : examCity1,
			"examCity2" : examCity2
	};

	$('#examCity3').empty().append(
	'<option value="-1">Select Exam City 3</option>');
	$('#examCity4').empty().append(
	'<option value="-1">Select Exam City 4</option>');
	
	if (examCity1 == -1 || examCity2 == -1) {
		return;
	} else {

		$.getJSON('getExamCities3.html', formInput, function(data) {
			
			var sortedCities = jsonObjToSortedArray(data.examCities3);
			loadSelectBoxNew('#examCity3', sortedCities);
		}).error(function() {
			// alert("Your session is been expired ! ");
			// jQuery("#confirmPaperSelection").modal('show');
			$('#sessionExpired').modal({
				backdrop : 'static',
				keyboard : false
			}).one('click', '#ok', function(e) {
				location.href = "login.html";
				return true;
			});
			// location.href="login.html";
		});
	}
}

function fetchExamCities4() {
	toggleCities();
	var examCity1 = $('#examCity1').val();
	var examCity2 = $('#examCity2').val();
	var examCity3 = $('#examCity3').val();
	var formInput = {
			"examCity1" : examCity1,
			"examCity2" : examCity2,
			"examCity3" : examCity3
	};

	$('#examCity4').empty().append(
	'<option value="-1">Select Exam City 4</option>');
	if (examCity1 == -1 || examCity2 == -1 || examCity3 == -1) {
		return;
	} else {

		$.getJSON('getExamCities4.html', formInput, function(data) {
			
			var sortedCities = jsonObjToSortedArray(data.examCities4);
			loadSelectBoxNew('#examCity4', sortedCities);
		}).error(function() {
			$('#sessionExpired').modal({
				backdrop : 'static',
				keyboard : false
			}).one('click', '#ok', function(e) {
				location.href = "login.html";
				return true;
			});
			// location.href="login.html";
		});
	}
}

/* Convert jsonobject to array and sort array 
 * Added in GATE-2020 by Mrunali*/
function jsonObjToSortedArray(jsonObject){
	
	var sortable = [];
	for (var entry in jsonObject) {
	    sortable.push([entry, jsonObject[entry]]);
	}
	sortable.sort(function(a, b) {
	    return a[1] > b[1] ? 1 : -1;  
	});
	return sortable;
}

function toggleEligCert() {
	var isDegreeComplete = $('input[name="isDegreeComplete"]:checked').val();
	var eligCert = $('label[for="eligibilityCert"]');

	if (isDegreeComplete == "true") {
		eligCert.text("Upload Eligibility Certificate");
		$('.help_eligibiltyCert').html('Upload an eligibility certificate of PDF format. File size should be between 10KB and 300KB.');
		$("#isDegreeCompleteText").addClass("hidden");
	} else {
		eligCert
		.text("Upload Certificate from the HOD / Institute");
		$('.help_eligibiltyCert').html('Upload a PDF file of duly signed certificate from the Head of the Department / Institute in the <a class="text-danger" href="https://drive.google.com/file/d/1jZl6bVD9JMc5mjrGnX_9lt3gFFl0gmJM/view" target="_blank">prescribed format</a>. File size should be between 10KB and 300KB.');
		$("#isDegreeCompleteText").removeClass("hidden");
	}
}

function toggleDegreeCompleteText(){
	var isDegreeComplete = $('input[name="isDegreeComplete"]:checked').val();
	if (isDegreeComplete == "true") {
		$("#isDegreeCompleteText").addClass("hidden");
	}else{
		$("#isDegreeCompleteText").removeClass("hidden");
	}
}

function toggleScribeRequest(isChanged) {
	
	var isPwD = $('input[name="personWithDisability"]:checked').val();
	var isDyslexicCandidate = $('input[name="personWithDyslexic"]:checked').val();

	if (isPwD == "true" || isDyslexicCandidate=="true") {
		$("#scribeRequest").removeClass("hidden");
		if (isChanged){
			$("input[name=visuallyImpaired][value='false']").prop("checked",true);
			$("#scribeText").addClass("hidden");
		}
	} else {
		$("#scribeRequest").addClass("hidden");
		$("input[name=visuallyImpaired][value='false']").prop("checked",true);
	}

	if (isPwD == "true") {
		$("#pwdPercentageDiv").removeClass("hidden");
		$("#disabilitylist").removeClass("hidden");
		$("div.pwdCert").removeClass("hidden");
		$("#staircaseAbilityDiv").removeClass("hidden");
	}
	else{
		$("div.pwdCert").addClass("hidden");
		$("#disabilitylist").addClass("hidden");
		$("#pwdPercentageDiv").addClass("hidden");
		$("#staircaseAbilityDiv").addClass("hidden");
		$("input[name=staircaseAbility][value='true']").prop("checked",true);
	}
	
	if (isDyslexicCandidate == "true") {
		$("div.dyslexicCert").removeClass("hidden");
		$("#dyslexicText").removeClass("hidden");
	}
	else{
		$("div.dyslexicCert").addClass("hidden");
		$("#dyslexicText").addClass("hidden");
	}
}

function showScribeText(){
	var visuallyImpaired = $('input[name="visuallyImpaired"]:checked').val();
	if(visuallyImpaired == "true"){
		$("#scribeText").removeClass("hidden");
	}else{
		$("#scribeText").addClass("hidden");
	}
}

function toggleCategoryCert() {
	var category = $('input[name="category"]:checked').val();

	if (category == 3 || category == 4) {
		$("div.categoryCert").removeClass("hidden");
		if (category == 3){
			$('#categoryCertLabel').text("Upload Category (SC) Certificate")
			
		} else
		{
			$('#categoryCertLabel').text("Upload Category (ST) Certificate")
			
		}
		
	} else {
		$("div.categoryCert").addClass("hidden");
	}
}

function continueStep2() 
{
	var currentTab = $(this).closest("div.tab-pane").attr("id");
	$('#applicationForm').append('<input name="currentTab" type="hidden" value="'+currentTab+'" />');
	var paper2 = $("#gatePaper2").val();
	if(paper2 == -1 || paper2 == null)
	{
		$("input[name=noOfPapers][value='1']").prop("checked",true);
	}
	
	$('#applicationForm').attr("action", "submitApplicationForm.html").append(
			'<input name="submitApplicationForm" type="hidden" value="'
			+ $('input[name="submitApplicationForm"][type="submit"]')
			.val() + '" />').submit();
	return false;
}

function saveAndView() 
{
	$('#applicationForm')
	.attr("action", "saveAndViewForm.html")
	.append(
			'<input name="saveApplicationForm" type="hidden" value="'
			+ $(
			'input[name="saveAndViewApplicationForm"][type="submit"]')
			.val() + '" />').submit();
}

function verifyEmailOTP() {
	$('#modalVerifyEmail').modal({
		backdrop : 'static',
		keyboard : false
	})
}

$('#modalVerifyEmail #ok').on("click", function(e) {
	$('#modalVerifyEmail #incorrectEmailOTP').hide();
	$('#modalVerifyEmail #resendEmailOTP').hide();
	$("#modalVerifyEmail #cannotSendEmailOTP").hide();

	var otp = $("#modalVerifyEmail #otpEmail").val().trim();
	//console.log("OK clicked ... check Email OTP: " + otp);
	if(otp){
		var formInput = { otp : otp	};
		$.getJSON('emailOTPVerification.html', formInput, function(data) {

			//console.log("verifyEmailOTP: 2"+data.isVerified);
			if(data.errMsg != undefined)
			{
				$('#emailOTP_ShowAfterSuccessfulOTPVerification').show();
				$("#emailOTP_ShowAfterSuccessfulOTPVerification > p").css("color", "red").html(data.errMsg);
				//$("#emailOTP_ShowAfterSuccessfulOTPVerification > p").css({color: '#000'});
				$('#emailOTPLanding').hide();
				$('#modalVerifyEmail #cancel').click();

			}
			else if(data.isVerified){
				$('#emailOTP_ShowAfterSuccessfulOTPVerification').show();
				$("#emailOTP_ShowAfterSuccessfulOTPVerification > p").css("color", "green").html("&#x2714 Verified")
				$('#emailOTPLanding').hide();
				$('#modalVerifyEmail #cancel').click();
				//$('#incorrectEmailOTP').hide();
			}
			else{
				//console.log("verifyEmailOTP incorrect OTP ewsa "+data.isVerified);
				$("#modalVerifyEmail #incorrectEmailOTP").show();
				//return false;
			}
		}).error(function(data) {
			//console.log(data.errMsg);
			$('#modalVerifymobile #cancel').click();
			$('#sessionExpired').modal({
				backdrop : 'static',
				keyboard : false
			}).one('click', '#ok', function(e) {
				location.href = "login.html";
				return true;
			});
		});
	}
	else
	{
		$('#modalVerifyEmail #incorrectEmailOTP').show();
		//console.log("empty mobile otp");
		return false;
	}
	return true;
});

$('#modalVerifyEmail #reSendEmailOTPBtn').on("click",function(event) {
	$('#modalVerifyEmail #incorrectEmailOTP').hide();
	$.getJSON('reSendEmailOTP.html', null ,function(data) {
		if(data.errMsg != undefined)

		{
			$('#emailOTP_ShowAfterSuccessfulOTPVerification').show();
			$("#emailOTP_ShowAfterSuccessfulOTPVerification > p").css("color", "red").html(data.errMsg)
			$('#emailOTPLanding').hide();
			$('#modalVerifyEmail #cancel').click();

		}
		else if(data.isOtpSent){
			$('#modalVerifyEmail #resendEmailOTP').show();
			//$('#incorrectMobileOTP').hide();
		}
		else{
			//console.log("error in resending OTP ");
			$("#modalVerifyEmail #cannotSendEmailOTP").show();
			//return false;
		}
	}).error(function() {
		//console.log("error in resending OTP-serverErr ");
		$("#modalVerifyEmail #cannotSendEmailOTP").show();
	});
	event.stopPropagation();
});
// }



function verifyMobileOTP() {
	$('#modalVerifymobile').modal({
		backdrop : 'static',
		keyboard : false
	})
}	

$('#modalVerifymobile #ok').on("click", function(e) {
	$('#modalVerifymobile #incorrectMobileOTP').hide();
	$('#modalVerifymobile #resendMobileOTP').hide();
	$("#modalVerifymobile #cannotSendMobileOTP").hide();

	var otp = $("#modalVerifymobile #otpMobile").val().trim()
	//console.log("OK clicked ... check mobile OTP: " + otp);
	if(otp){
		var formInput = { otp : otp	};
		$.getJSON('mobileOTPVerification.html', formInput, function(data) {
			//console.log("verifyMobileOTP: 2"+data.isVerified);
			if(data.errMsg != undefined)
			{
				$('#mobileOTP_ShowAfterSuccessfulOTPVerification').show();
				$("#mobileOTP_ShowAfterSuccessfulOTPVerification > p").css("color", "red").html(data.errMsg);
				$('#mobileOTPLanding').hide();
				$('#modalVerifymobile').modal('hide');

			}
			else if(data.isVerified){
				$('#mobileOTP_ShowAfterSuccessfulOTPVerification').show();
				$("#mobileOTP_ShowAfterSuccessfulOTPVerification > p").css("color", "green").html("&#x2714 Verified")
				$('#mobileOTPLanding').hide();
				$('#modalVerifymobile').modal('hide');
				//$('#incorrectMobileOTP').hide();
			}
			else{
				//console.log("verifyMobileOTP incorrect OTP ewsa "+data.isVerified);
				$("#modalVerifymobile #incorrectMobileOTP").show();
				//return false;
			}
		}).error(function(data) {
			//console.log(data.errMsg);
			$('#modalVerifymobile #cancel').click();
			$('#sessionExpired').modal({
				backdrop : 'static',
				keyboard : false
			}).one('click', '#ok', function(e) {
				location.href = "login.html";
				return true;
			});
		});
	}
	else
	{
		$('#modalVerifymobile #incorrectMobileOTP').show();
		//console.log("empty mobile otp");
		return false;
	}
	return true;
})

$('#modalVerifymobile #reSendMobileOTPBtn').on("click",function(event) {
	//console.log("Resend clicked");
	$('#modalVerifymobile #incorrectMobileOTP').hide();
	$.getJSON('reSendMobileOTP.html', null ,function(data) {
		//console.log("verifyMobileOTP: 2"+data.isVerified);
		//console.log("verifyMobileOTP: 2"+data.isVerified);
		if(data.errMsg != undefined)
		{
			$('#mobileOTP_ShowAfterSuccessfulOTPVerification').show();
			$("#mobileOTP_ShowAfterSuccessfulOTPVerification > p").css("color", "red").html(data.errMsg)
			$('#mobileOTPLanding').hide();
			$('#modalVerifymobile').modal('hide');

		}
		else if(data.isOtpSent){
			$('#modalVerifymobile #resendMobileOTP').show();
			//$('#incorrectMobileOTP').hide();
		}
		else{
			//console.log("error in resending OTP ");
			$("#modalVerifymobile #cannotSendMobileOTP").show();
			//return false;
		}
	}).error(function() {
		//console.log("error in resending OTP-serverErr ");
		$("#modalVerifymobile #cannotSendMobileOTP").show();
	});

});

function toggleParentNationalityList(ischanged) 
{
	var nationality = $('input[name="nationalityParent"]:checked').val();
	if (nationality === "Other") {
		$("#nationalityParent_countries").show();
		$("#parentMobileNumber").attr('maxlength', '12');
		$('#parentMobileCountryCode').empty().html(cloneCountryCodes);
		if(ischanged)
		{
			$('#parentMobileCountryCode').val("-1");
			$('#nationalityParentValue').val("-1");
		}
		$('#parentMobileCountryCode option[value=91]').hide();
	} else {
		$("#nationalityParent_countries").hide();
		$("#parentMobileNumber").attr('maxlength', '10');
		$('#parentMobileCountryCode').empty().append('<option value="91">91 (IN)</option>');
		$('#parentMobileCountryCode').val('91');
	}
}

function changeParentMobileCountryCode() 
{
	var index = document.getElementById("nationalityParentValue").selectedIndex;
	//console.log("selectedIndex : " +index);
	//document.getElementById("parentMobileCountryCode").selectedIndex = "5";
	$("select#parentMobileCountryCode")[0].selectedIndex = index + 1;
}

function concatName(){
	var firstName = $("#firstName").val();
	var middleName = $("#middleName").val();
	var lastName = $("#lastName").val();
	
	if (firstName == null)
		firstName = "";
	if (middleName == null)
		middleName = "";
	if (lastName == null)
		lastName = "";
	
	var fullName = firstName.concat(" " + middleName).concat(" " + lastName);
	fullName = fullName.replace(/ +/g," ");
	$("#applicantName").val(fullName.toUpperCase().trim());
}

$("#dobYear").on("change", function(e){
	var yearselected = $("#dobYear").val();
	var monthselected = $("#dobMonth").val();
	var dayselected = $("#dobDay").val();

	if (yearselected != -1 && monthselected != -1 && dayselected != -1) {
		var dob = ""; 
		dob = dob + $("#dobDay option:selected").text() + " " + $("#dobMonth option:selected").text() + " " + $("#dobYear option:selected").text();
		$('#selectedDOB').text(dob);
		$('#confirmDOB').modal({
			backdrop : 'static',
			keyboard : false
		}).one('click', '#continue', function(e) {
			return true;
		}).one('click', '#cancel', function(e) {
			$("#dobDay").val($("#dobDay option:first").val());
			$("#dobMonth").val($("#dobMonth option:first").val());
			$("#dobYear").val($("#dobYear option:first").val());
		});
	}
	else
	{
		if (dayselected == -1)
		{
			window.alert("Please select day");
		}
		else 
		{
			window.alert("Please select month");
		}
		$("#dobYear").val($("#dobYear option:first").val());
	}
})

$("#sourceOfInformation").on("change", function(e){
	var selectedSource = $("#sourceOfInformation").val();
	if (selectedSource == "Other"){
		$("#otherSourceOfInfoDiv").removeClass("hidden");
	}else{
		$("#otherSourceOfInfoDiv").addClass("hidden");
	}
})

$(document).ready(function(){
	//console.log("val2 = " + $("#gateSubpaper2").val());
	var selectedSource = $("#sourceOfInformation").val();
	if (selectedSource == "Other"){
		$("#otherSourceOfInfoDiv").removeClass("hidden");
	}else{
		$("#otherSourceOfInfoDiv").addClass("hidden");
	}
	
	//window.alert("Please save an application form time to time to avoid re-entering data.");
	allNextBtn = $('.nextBtn');
	allPrevBtn = $('.prevBtn');
	var navListItems = $('div.setup-panel div a');
	
	var tabShow = $('#tabShow').val();
	
	if(tabShow != null && tabShow != "" ){
		
		navListItems.removeClass('btn-success').addClass('btn-default');
		currentStepWizard = $('div.setup-panel div a[href="#' + tabShow + '"]');
		currentStepWizard.removeAttr('disabled').addClass('btn-success').trigger('click');
	}
	
	 navListItems.click(function (e) {
		/* alert("next tab click");*/
	        e.preventDefault();
	        var $target = $($(this).attr('href')),
	            $item = $(this);

	        if (!$item.hasClass('disabled')) {
	            navListItems.removeClass('btn-success').addClass('btn-default');
	            $item.addClass('btn-success');
	        /*    $target.show();
	            $target.find('input:eq(0)').focus();*/
	        }
	    });
	 
	 allNextBtn.click(function () {
		/* alert('allNextBtn.click');*/
	        var curStep = $(this).closest(".tab-pane"),
	            curStepBtn = curStep.attr("id"),
	            nextStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().next().children("a"),
	            currentStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]');
	        
	            currentStepWizard.removeClass('btn-success').addClass('btn-default');
	            nextStepWizard.removeAttr('disabled').addClass('btn-success').trigger('click');
	    });
	
	 allPrevBtn.click(function () {
	        var curStep = $(this).closest(".tab-pane"),
	            curStepBtn = curStep.attr("id"),
	            nextStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().prev().children("a"),
	            currentStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]');
	            currentStepWizard.removeClass('btn-success').addClass('btn-default');
	        	nextStepWizard.removeAttr('disabled').addClass('btn-success').trigger('click');
	    });  
	 
	 $(".savebtn").click(function(e){
			//e.preventDefault();
			var currentTab = $(this).closest("div.tab-pane").attr("id");
			$('#applicationForm').append('<input name="currentTab" type="hidden" value="'+currentTab+'" />');
			var paper2 = $("#gatePaper2").val();
			if(paper2 == -1 || paper2 == null)
			{
				$("input[name=noOfPapers][value='1']").prop("checked",true);
			}
	});
	
	 $("#loading-Form").hide();
})


